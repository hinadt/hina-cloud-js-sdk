var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};function e(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r,n,o,i=function(){return i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},i.apply(this,arguments)};function a(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))}function s(t,e){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function c(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function l(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError,function(t){t.LOG="log",t.INFO="info",t.WARN="warn",t.ERROR="error",t.ASSERT="assert"}(r||(r={})),function(t){t.BEACON="beacon",t.IMAGE="image",t.AJAX="ajax"}(n||(n={})),function(t){t.INTEGER="INTEGER",t.STRING="STRING",t.BOOLEAN="BOOLEAN"}(o||(o={}));var h=function(t,e){this.options=t,this.context=e,this.disabled=!1},p=["utm_source","utm_medium","utm_campaign","utm_content","utm_term"];l(l([],u(p),!1),u(["ha_utm"]),!1);var f=["www.baidu.","m.baidu.","m.sm.cn","so.com","sogou.com","youdao.com","google.","yahoo.com/","bing.com/","ask.com/"],d=["weibo.com","renren.com","kaixin001.com","douban.com","qzone.qq.com","zhihu.com","tieba.baidu.com","weixin.qq.com"],g={baidu:["wd","word","kw","keyword"],google:"q",bing:"q",yahoo:"p",sogou:["query","keyword"],so:"q",sm:"q"},v="hinasdk_domain_test",m=Object.prototype.toString;function y(t){return"[object Object]"===m.call(t)}function b(t){return null!=t}function w(t){return Array.isArray(t)}function _(t){return"function"==typeof t}function S(t){return"string"==typeof t}function x(t){return"number"==typeof t&&!Number.isNaN(t)}function k(t){return"boolean"==typeof t}function T(){}function A(t){try{return JSON.parse(t)}catch(t){}return t}function H(t){return 0===Object.keys(t).length}function I(){return Date.now&&_(Date.now)?Date.now():(new Date).getTime()}function C(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object.create(null);return t.forEach((function(t){t&&Object.keys(t).forEach((function(e){var n=t[e];y(n)?y(r[e])?r[e]=C(r[e],n):r[e]=C(n):r[e]=n}))})),r}function R(t){var e={};try{e=new URL(t)}catch(t){}return e}function P(t,e){if(!t)return t;var r=t.toString(),n=r.indexOf(".");return r=-1!==n?r.substring(0,n+e+1):r.substring(0),parseFloat(r)}function N(t){t=t||window.location.hostname,/^[a-zA-Z0-9\u4e00-\u9fa5\-\\.]+$/.exec(t)||(t="");var e=t.split(".");if(e.length>=2&&!/^(\d+\.)+\d+$/.test(t))for(var r=".".concat(e.splice(e.length-1,1));e.length>0;)if(r=".".concat(e.splice(e.length-1,1)).concat(r),document.cookie="".concat(v,"=true; path=/; domain=").concat(r),-1!==document.cookie.indexOf("".concat(v,"=true")))return document.cookie="".concat(v,"=true; path=/; domain=").concat(r,"; max-age=0"),r;return""}function L(){var t=N();return""===t?"url解析失败":t}function E(t){var e=t||document.referrer;return"string"!=typeof e?"referrer exception".concat(String(e)):(e.startsWith("https://www.baidu.com/")&&(e=e.split("?")[0]),"string"==typeof(e=e.slice(0,200))?e:"")}function O(t,e){return e&&"string"==typeof e||(e="hostname解析异常"),t&&(R(t).hostname||"")||e}function D(){var t=I(),e=Math.floor(1e6*Math.random());return Number(String(t).slice(-5)+String(e).slice(0,4))}function U(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=decodeURIComponent(t);var r=new RegExp("[\\?&]".concat(e,"=([^&#]*)")).exec(t);return null===r||r&&"string"!=typeof r[1]&&r[1].length?"":decodeURIComponent(r[1])}function B(t){try{return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x".concat(e)))})))}catch(e){return t}}function W(t,e,r,n){if(void 0!==t&&(e in t||n)){var o=r(t[e]);_(o)&&(t[e]=o)}}var M=function(){function t(){this.name="CookieStorage"}return t.prototype.isSupport=function(t,e){var r=this;void 0===t&&(t="cookie_support_test"),void 0===e&&(e="1");return navigator.cookieEnabled&&(r.set(t,e),r.get(t)===e&&(r.remove(t),!0))},t.prototype.get=function(t){var e,r,n=document.cookie.split(";");try{for(var o=c(n),i=o.next();!i.done;i=o.next()){var a=i.value.split("=");if(a[0].trim()===t)return decodeURIComponent(a[1])}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return null},t.prototype.set=function(t,e,r,n,o,i,a){n=n||"/",t=t.trim(),e=e.trim();var s="".concat(t,"=").concat(encodeURIComponent(e),"; path=").concat(n,";");r=b(r)?r:63072e8,s+=" max-age=".concat(r,";"),a&&(s+=" secure;"),o&&(s+=" domain=".concat(o,";")),["Strict","Lax","None"].includes(i)&&(s+=" SameSite=".concat(i,";")),document.cookie=s},t.prototype.remove=function(t,e){void 0===e&&(e="/"),this.set(t,"1",0,e)},t.prototype.setDomain=function(t,e,r){var n=L();"url解析失败"===n&&(n=""),this.set(t,e,r,"/",n)},t}(),j=function(){function t(){this.name="LocalStorage"}return t.prototype.isSupport=function(){var t=!0;try{var e="__localStorageSupport__",r="testIsSupportStorage";this.set(e,r),this.get(e)!==r&&(t=!1),this.remove(e)}catch(e){t=!1}return t},t.prototype.key=function(t){return window.localStorage.key(t)},t.prototype.get=function(t){return window.localStorage.getItem(t)},t.prototype.length=function(){return window.localStorage.length},t.prototype.set=function(t,e){try{window.localStorage.setItem(t,e)}catch(t){}},t.prototype.remove=function(t){window.localStorage.removeItem(t)},t.prototype.parse=function(t){var e=this.get(t);try{e=JSON.parse(e)}catch(t){e=""}return e},t}(),q=function(){function t(){this.name="MemoryStorage",this.data={}}return t.prototype.get=function(t){var e=this.data[t];return b(null==e?void 0:e.expireTime)?e.expireTime<I()?null:e.value:null==e?void 0:e.value},t.prototype.set=function(t,e,r){if(b(r)){var n=I()+1e3*r;this.data[t]={value:e,expireTime:n}}this.data[t]={value:e}},t.prototype.setDomain=function(t,e,r){this.set(t,e,r)},t}();function F(t,e){if(void 0===e&&(e=r.LOG),"undefined"!=typeof console){var n=console[e]||console.log;"function"==typeof n&&n(t)}}var z,K={all:z=z||new Map,on:function(t,e){var r=z.get(t);r?r.push(e):z.set(t,[e])},emit:function(t,e){var r=z.get(t);r&&r.forEach((function(t){t(e)}))},off:function(t,e){var r=z.get(t);if(r)if(e){var n=r.indexOf(e);n>=0&&r.splice(n,1)}else z.set(t,[])}},V=function(){function t(t,e){this.options=t,this.isFirstTime=!1,this.isFirstDay=!1,this.state=e}return t.prototype.log=function(t,e){void 0===e&&(e=r.LOG),this.options.showLog&&F(t,e)},t.prototype.checkSetValue=function(t,e){return!(!x(e=null!=e?e:"")&&!S(e))||(this.log("".concat(t,": id must be string or number"),r.WARN),!1)},t.prototype.setDeviceId=function(t){void 0===t&&(t=""),this.checkSetValue("deviceId",t)&&this.set("deviceId",t)},t.prototype.setAccountId=function(t){void 0===t&&(t=""),this.checkSetValue("accountId",t)&&(this.set("accountId",t),K.emit("changeAccountId"))},t.prototype.setAnonymousId=function(t){this.state.anonymousId?this.log("Current anonymousId is ".concat(this.getAnonymousId(),", it has been set"),r.WARN):this.checkSetValue("anonymousId",t)&&this.set("anonymousId",t)},t.prototype.setProps=function(t){var e=C(this.state.props||{},t);for(var r in e)"string"==typeof e[r]&&(e[r]=e[r].slice(0,200));this.set("props",e)},t.prototype.getAnonymousId=function(){return this.state.anonymousId},t.prototype.getDeviceId=function(){return this.state.deviceId},t.prototype.getAccountId=function(){return this.state.accountId},t.prototype.clear=function(){this.state={},this.save()},t.prototype.set=function(t,e){this.state[t]=e,this.save()},t.prototype.afterInit=function(t){t?(this.isFirstDay=function(t){var e;try{var r=new Date,n=r.getFullYear(),o=r.getMonth()+1,i=r.getDate(),a=new Date(t),s=a.getFullYear(),c=a.getMonth()+1,u=a.getDate();e=n===s&&o===c&&i===u}catch(t){e=!1}return e}(this.state.firstVisitTime),this.save()):(this.isFirstDay=!0,this.isFirstTime=!0);var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return"x"===t?e.toString(16):(3&e|8).toString(16)}));this.getAnonymousId()||this.setAnonymousId(e),this.getDeviceId()||this.setDeviceId(e)},t}(),J=function(t){function n(e){var r=this,n={accountId:null,deviceId:null,anonymousId:null,sessionId:null,firstVisitTime:I(),props:{}};return(r=t.call(this,e,n)||this).options=e,r.storeName="hinasdk_crossdata",r.hLatestUtm={},r.hUtm={},r.customUtm={},r}return e(n,t),n.prototype.getUtmFromProps=function(t){for(var e in this.state.props){var r=this.state.props[e];e.startsWith("H_latest_")?this.hLatestUtm[e]=r:e.startsWith("H_")&&(this.hUtm[e]=r),t.includes(e)&&(this.customUtm[e]=r)}},n.prototype.init=function(){var t,e=new M,n=new q,o=new j;e.isSupport()?this.storage=e:(this.log("Cookie storage is not supported, SDK internal cache has been enabled",r.WARN),this.storage=n),o.isSupport()?this.localStorage=o:this.log("localStorage is not supported, SDK internal cache has been enabled",r.WARN),!(t=this.storage.get(this.storeName))&&this.localStorage&&(t=this.localStorage.get(this.storeName)),t&&function(t){try{JSON.parse(t)}catch(t){return!1}return!0}(t)?this.state=A(t):t=null,this.afterInit(t)},n.prototype.save=function(){this.storage.setDomain(this.storeName,JSON.stringify(this.state)),this.localStorage&&this.localStorage.set(this.storeName,JSON.stringify(this.state))},n.prototype.getCookie=function(){return this.storage.get(this.storeName)},n.prototype.setSessionId=function(t){this.set("sessionId",t)},n.prototype.getSessionId=function(){return this.state.sessionId||""},n.prototype.getSessionIdCreateTime=function(){var t=this.getSessionId().split("_")[0],e=Number(t);return Number.isNaN(e)?0:e},n}(V),G=function(){function t(){this.isReady=!1,this.isReady||this.init(),this.isReady=!0}return t.prototype.init=function(){this.os=this.getOs(),this.osVersion=this.getOsVersion();var t=this.getBrowser(),e=t.type,r=t.version;this.browserName=e,this.browserVersion=r,this.model=this.getModel()},t.prototype.getOs=function(){var t=navigator.userAgent;return/Windows/i.test(t)?/Phone/.test(t)||/WPDesktop/.test(t)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(t)&&!window.MSStream?"iOS":/Android/.test(t)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(t)?"BlackBerry":/Mac/i.test(t)?"Mac OS X":/Linux/.test(t)?"Linux":/CrOS/.test(t)?"Chrome OS":"取值异常"},t.prototype.getOsVersion=function(){var t=navigator.userAgent;if(/Windows/i.test(t)){var e=/Windows NT ([\d.]+)/;return t.match(e)?t.match(e)[1]:""}if(/(iPhone|iPad|iPod)/.test(t)&&!window.MSStream){e=/OS ([\d_]+)/;return t.match(e)?t.match(e)[1].replace(/_/g,"."):""}if(/Android/.test(t)){e=/Android ([\d.]+)/;return t.match(e)?t.match(e)[1]:""}if(/Mac/i.test(t)){e=/Mac OS X ([\d_]+)/;return t.match(e)?t.match(e)[1].replace(/_/g,"."):""}return""},t.prototype.getBrowser=function(){var t,e={type:"",version:""};try{var r=null===(t=navigator.userAgent)||void 0===t?void 0:t.toLowerCase(),n=[];if(null!==r.match(/baidubrowser/)?(e.type="baidu",n.push(/baidubrowser\/([\d.]+)/)):null!==r.match(/bidubrowser/)?(e.type="baidu",n.push(/bidubrowser\/([\d.]+)/)):null!==r.match(/edg/)?(e.type="edge",n.push(/edg\/([\d.]+)/)):null!==r.match(/edgios/)?(e.type="edge",n.push(/edgios\/([\d.]+)/)):null!==r.match(/liebaofast/)?(e.type="liebao",n.push(/liebaofast\/([\d.]+)/)):null!==r.match(/sogoumobilebrowser/)?(e.type="sogou",n.push(/sogoumobilebrowser\/([\d.]+)/)):null!==r.match(/lbbrowser/)?(e.type="liebao",n.push(/lbbrowser\/([\d.]+)/)):null!==r.match(/crios/)?(e.type="chrome",n.push(/crios\/([\d.]+)/)):null!==r.match(/qihoobrowser/)?(e.type="360",n.push(/qihoobrowser\/([\d.]+)/)):null!==r.match(/mxios/)?(e.type="maxthon",n.push(/mxios\/([\d.]+)/)):null!==r.match(/fxios/)?(e.type="firefox",n.push(/fxios\/([\d.\w]+)/)):null!==r.match(/edge/)?(e.type="edge",n.push(/edge\/([\d.]+)/)):null!==r.match(/metasr/)?(e.type="sogou",n.push(/metasr ([\d.]+)/)):null!==r.match(/micromessenger/)?(e.type="micromessenger",n.push(/micromessenger\/([\d.]+)/)):null!==r.match(/mqqbrowser/)?(e.type="qq",n.push(/mqqbrowser\/([\d.]+)/)):null!==r.match(/qqbrowserlite/)?(e.type="qq",n.push(/qqbrowserlite\/([\d.]+)/)):null!==r.match(/tencenttraveler/)?(e.type="qq",n.push(/tencenttraveler\/([\d.]+)/)):null!==r.match(/qqbrowser/)?(e.type="qq",n.push(/qqbrowser\/([\d.]+)/)):null!==r.match(/maxthon/)?(e.type="maxthon",n.push(/maxthon\/([\d.]+)/)):null!==r.match(/ubrowser/)?(e.type="uc",n.push(/ubrowser\/([\d.]+)/)):null!==r.match(/ucbrowser/)?(e.type="uc",n.push(/ucbrowser\/([\d.]+)/)):null!==r.match(/firefox/)?(e.type="firefox",n.push(/firefox\/([\d.]+)/)):null!==r.match(/opera/)?(e.type="opera",n.push(/opera\/([\d.]+)/)):null!==r.match(/opr/)?(e.type="opera",n.push(/opr\/([\d.]+)/)):null!==r.match(/chrome/)?(e.type="chrome",n.push(/chrome\/([\d.]+)/)):null!==r.match(/safari/)?(e.type="safari",n.push(/version\/([\d.]+)/)):null===r.match(/trident/)&&null===r.match(/msie/)||(e.type="ie"),"ie"===e.type){var o=r.match(/trident\/([\d.]+)/)?r.match(/trident\/([\d.]+)/)[1]:"",i=r.match(/msie ([\d.]+)/)?r.match(/msie ([\d.]+)/)[1]:"";""!==o?e.version=String(parseInt(o,10)+4):""!==i&&(e.version=i)}else n&&(e.version=r.match(n[0])?r.match(n[0])[1]:"")}catch(t){e.type="取值异常"}return e},t.prototype.getModel=function(){var t=navigator.userAgent;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)){if(/iPhone|iPad|iPod/i.test(t))return t.match(/iPhone|iPad|iPod/i)[0];if(/Android/i.test(t))return t.match(/Android/i)[0]}var e=t.match(/Mac/);if(e)return e[0];var r=t.match(/Windows/);if(r)return r[0];var n=t.match(/Linux/);return n?n[0]:"取值异常"},t}();function $(){return document.documentElement.scrollTop||document.body.scrollTop||0}function X(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}function Z(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0}var Y=function(){function t(t){this.visibleHandler=function(){},this.hiddenHandler=function(){};var e=t.visible,r=t.hidden;_(e)&&(this.visibleHandler=e),_(r)&&(this.hiddenHandler=r),this.init()}return t.prototype.isSupport=function(){return void 0!==document.hidden},t.prototype.init=function(){var t=this;this.isSupport()?document.addEventListener("visibilitychange",(function(){document.hidden?t.hiddenHandler():t.visibleHandler()})):(window.addEventListener("focus",this.visibleHandler),window.addEventListener("blur",this.hiddenHandler))},t}();var Q=function(){function t(t){this.options=t}return t.prototype.run=function(){var t=this;return new Promise((function(e){var r=t.options,n=r.imgUseCrossOrigin,o=r.url,i=r.data,a=new Image;n&&(a.crossOrigin="anonymous");var s=-1===o.indexOf("?")?"?":"&";a.src="".concat(o).concat(s).concat(i);var c=function(t){a=null,e({type:t})};a.onload=function(){c("success")},a.onerror=function(){c("success")}}))},t}(),tt=function(){function t(t){this.options=t}return t.prototype.run=function(){var t=this;return new Promise((function(e){var r=t.options,n=r.url,o=r.data,i=r.timeout,a=r.credentials,s=r.contentType,c=r.customHeaders,u=void 0===c?{}:c,l=new XMLHttpRequest;l.open("POST",n,!0),l.timeout=i||2e4,l.isMonitor=!0,a&&(l.withCredentials=!0),l.setRequestHeader("Content-Type",s||"application/x-www-form-urlencoded"),y(u)&&!H(u)&&Object.keys(u).forEach((function(t){l.setRequestHeader(t,u[t])})),l.send(o||null),l.ontimeout=function(){l.abort()},l.onreadystatechange=function(){4===l.readyState&&(l.status>=200&&l.status<300||304===l.status?e({data:JSON.parse(l.responseText)||{},type:"success"}):e({type:"fail",msg:"网络异常, 请求失败，状态码=".concat(l.status)}))}}))},t}(),et=function(){function t(t){this.options=t}return t.prototype.run=function(){var t=this;return new Promise((function(e){var r=t.options,n=r.url,o=r.data;navigator.sendBeacon&&e(navigator.sendBeacon(n,o)?{type:"success"}:{type:"fail",msg:"sendBeacon 请求失败"})}))},t}(),rt=function(){function t(t,e,r){void 0===e&&(e="hinasdk_tab"),void 0===r&&(r="hinasdk_data_"),this.options=t,this.batchKey=e,this.batchDataKey=r,this.isSending=!1,this.init()}return t.prototype.log=function(t,e){void 0===e&&(e=r.LOG),this.options.showLog&&F(t,e)},t.prototype.init=function(){var t=new j;t.isSupport()?(this.localStorage=t,this.isSupport=!0):(this.isSupport=!1,this.log("批量发送功能需要使用localstorage存储数据，但是您的浏览器不支持localstorage，所以不能使用该功能",r.WARN)),this.batchInterval()},t.prototype.getBatchConfig=function(){return this.options.batchSend},t.prototype.getStorageList=function(){if(!this.isSupport)return[];var t=[],e=this.localStorage.get(this.batchKey);return e&&(w(t=A(e))||(t=[])),t},t.prototype.batchInterval=function(){var t=this;if(this.isSupport){var e=this.getBatchConfig().sendInterval;setTimeout((function(){t.send().then((function(){t.batchInterval()}))}),e)}},t.prototype.send=function(){var t=this;return new Promise((function(e){var r=t.getStorageList();if(r.length>0&&t.isSupport){for(var n=t.getBatchConfig().dataSendTimeout,o=I(),i=[],a={},s=r.length,c=0;c<s;c++){var u=r[c],l=u.dataKey,h=u.expireTime;if(h>=o)a[l]={dataKey:l,expireTime:h},(y=t.localStorage.get(l))&&i.push(A(y));else t.localStorage.remove(l),r.splice(c,1),s--,c--}if(t.localStorage.set(t.batchKey,JSON.stringify(r)),0===i.length)e();else{var p=t.options,f=p.serverUrl,d=p.customHeaders,g=p.credentials,v=p.globalCallback,m=JSON.stringify(i),y=encodeURIComponent(B(m));t.isSending=!0,new tt({url:f,data:"data_list=".concat(y),timeout:n,credentials:g,customHeaders:d}).run().then((function(r){_(v)&&v(f,i,r.type,r.msg||""),"success"===r.type&&t.remove(a),e(),t.isSending=!1}))}}else e()}))},t.prototype.remove=function(t){var e=this;if(this.isSupport){var r=this.getStorageList(),n=Object.keys(t);if(n.forEach((function(t){e.localStorage.remove(t)})),r.length===n.length)this.localStorage.set(this.batchKey,JSON.stringify([]));else{var o=r.filter((function(e){return!t[e.dataKey]}));this.localStorage.set(this.batchKey,JSON.stringify(o))}}},t.prototype.add=function(t){if(this.isSupport){var e,r,n=this.getBatchConfig(),o=n.sendInterval,i=n.storageLimit,a=this.batchDataKey+(e=I(),r=Math.floor(1e6*Math.random()),"".concat(e,"_").concat(r)),s=this.getStorageList();s.unshift({dataKey:a,expireTime:I()+2*o}),this.localStorage.set(this.batchKey,JSON.stringify(s)),this.localStorage.set(a,JSON.stringify(t)),!this.isSending&&(s.length>i||"track_signup"===t.type||"H_pageview"===t.event)&&this.send()}},t}();function nt(t,e){Object.keys(t).forEach((function(n){var o=t[n];if(S(o)&&o.length>e)F("属性 ".concat(n," 已经做截取")),t[n]=o.slice(0,e);else if(y(o))nt(o,e);else if(_(o))try{t[n]=o(t),_(t[n])?(F("属性--".concat(n," 格式不满足要求, 已被删除"),r.WARN),delete t[n]):y(t[n])?nt(t[n],e):S(t[n])&&t[n].length>e&&(t[n]=t[n].slice(0,e))}catch(e){F("属性--".concat(n," 格式不满足要求, 已被删除"),r.WARN),delete t[n]}}))}var ot=["abtestExperimentId","paramName","valueType","defaultValue","callback","timeoutMilliseconds","customProperties","customIds"],it=function(t){function n(e,r,n,o,i){var a=t.call(this,e,r)||this;return a.options=e,a.context=r,a.name="AbtestBasePlugin",a.isReady=!1,a.platform="",a.storageName="",a.version="",a.projectKey="",a.platform=n,a.storageName=o,a.version=i,a}return e(n,t),n.prototype.init=function(){var t=this;if(this.context.store.localStorage){var e=this.options.abTestingPluginConfig,n=null==e?void 0:e.url;if(S(n)){var o=U(n,"project-key");if(o){if(this.projectKey=o,["Web","H5"].includes(this.platform)){var i=R(n).protocol,a=R(window.location.href).protocol;i&&i!==a&&this.context.log("A/B Testing 初始化失败，".concat(a," 页面必须使用 ").concat(a," 的 URL"),r.WARN)}if(this.isReady)this.context.log("A/B Testing 插件已经运行，无需重复执行",r.WARN);else{var s=this.context.getUserUid();this.context.log("当前accountId为：".concat(s),r.INFO),K.on("changeAccountId",(function(){t.context.store.localStorage.set(t.storageName,"")})),this.isReady=!0}}else this.context.log("A/B Testing 初始化失败，请使用正确的 URL（必须包含 project-key）")}else this.context.log("A/B Testing 初始化失败，请使用正确的 URL！",r.WARN)}else this.context.log("A/B Testing 初始化失败，浏览器不支持localStorage",r.WARN)},n.prototype.transform=function(){},n.prototype.valueMatchType=function(t,e){switch(e){case o.INTEGER:return x(t);case o.STRING:return S(t);case o.BOOLEAN:return k(t);default:return!1}},n.prototype.normalizeParams=function(t,e,n){var i,a;void 0===n&&(n=ot);var s={verify_success:!0,para:e};try{for(var u=c(n),l=u.next();!l.done;l=u.next()){var h=l.value;if(!s.verify_success)break;switch(h){case"abtestExperimentId":S(e.abtestExperimentId)&&e.abtestExperimentId.trim()||(this.context.log("".concat(t,"方法调用失败，").concat(h,"参数未正确配置！").concat(h,": ").concat(e.abtestExperimentId),r.WARN),s.verify_success=!1);break;case"paramName":S(e.paramName)&&e.paramName.trim()||(this.context.log("".concat(t,"方法调用失败，").concat(h,"参数未正确配置！").concat(h,": ").concat(e.paramName),r.WARN),s.verify_success=!1);break;case"valueType":[o.BOOLEAN,o.INTEGER,o.STRING].includes(e.valueType)||(this.context.log("".concat(t,"方法调用失败，").concat(h,"参数未正确配置！").concat(h,": ").concat(e.valueType),r.WARN),s.verify_success=!1);break;case"defaultValue":this.valueMatchType(e.defaultValue,e.valueType)||(this.context.log("".concat(t,"方法调用失败，").concat(h,"类型必须与valueType一致！"),r.WARN),s.verify_success=!1);break;case"callback":_(e.callback)||(this.context.log("".concat(t,"方法调用失败，").concat(h,"参数未正确配置")),e.callback=T,s.verify_success=!1);break;case"timeoutMilliseconds":(!x(e.timeoutMilliseconds)||e.timeoutMilliseconds<=0)&&(this.context.log("".concat(h,"参数错误：").concat(e.timeoutMilliseconds),r.WARN),e.timeoutMilliseconds=3e3),e.timeoutMilliseconds<200&&(e.timeoutMilliseconds=200);break;case"customProperties":e.customProperties=y(e.customProperties)?e.customProperties:{};break;case"customIds":var p=e.customIds||{},f={};for(var d in p)(S(p[d])||x(p[d]))&&(f[d]=p[d]);e.customIds=f}}}catch(t){i={error:t}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}return s},n.prototype.sendTriggerEvent=function(t){var e=t.abtest_experiment_group_id,r=t.abtest_experiment_id;this.context.track("H_ABTestTrigger",{H_abtest_experiment_id:r,H_abtest_experiment_group_id:e})},n.prototype.getExpResult=function(t){return a(this,arguments,void 0,(function(t,e){var r,n,o,i,a,u,l,h,p,f,d,g,v,m,b;return void 0===e&&(e=[]),s(this,(function(s){switch(s.label){case 0:return r=t.abtestExperimentId,n=t.paramName,o=t.valueType,0!==e.length?[3,2]:[4,this.getStorageData()];case 1:y(a=s.sent())&&(e=a.result||[]),s.label=2;case 2:try{for(u=c(e),l=u.next();!l.done;l=u.next())if(h=l.value,p=h.abtest_experiment_id,f=h.abtest_experiment_group_id,d=h.is_white_list,g=h.variables,p===r&&(v=g.find((function(t){return t.name===n&&t.type===o})),v)){d||this.sendTriggerEvent({abtest_experiment_id:p,abtest_experiment_group_id:f}),i=v.value;break}}catch(t){m={error:t}}finally{try{l&&!l.done&&(b=u.return)&&b.call(u)}finally{if(m)throw m.error}}return[2,i]}}))}))},n.prototype.getStorageData=function(){return a(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.context.store.localStorage.get(this.storageName)];case 1:return(t=e.sent())?[2,A(t)]:[2,null]}}))}))},n.prototype.saveResponseData=function(t){return a(this,void 0,void 0,(function(){var e,r,n,o;return s(this,(function(i){switch(i.label){case 0:return[4,this.getStorageData()];case 1:return e=i.sent(),r={updateTime:I()},e&&y(e)?(n=[],o=e.result||[],t.forEach((function(t){var e=t.abtest_experiment_group_id,r=t.abtest_experiment_id,i=t.variables,a=o.find((function(t){return t.abtest_experiment_id===r&&t.abtest_experiment_group_id===e}));if(a){var s=[];i.forEach((function(t){var e=t.name,r=t.type,n=a.variables.findIndex((function(t){return t.name===e&&t.type===r}));n>=0?a.variables[n]=t:s.push(t)})),a.variables=l(l([],u(a.variables),!1),u(s),!1)}else n.push(t)})),r.result=l(l([],u(o),!1),u(n),!1)):r.result=t,this.context.store.localStorage.set(this.storageName,JSON.stringify(r)),[2]}}))}))},n.prototype.createRequestData=function(t){var e=t.paramName,r=t.customProperties,n=t.customIds,o={anonymous_id:this.context.store.getAnonymousId(),platform:this.platform,abtest_lib_version:this.version,param_name:e,properties:this.context.getPresetProperties()};return y(r)&&!H(r)&&(o.custom_properties=r),y(n)&&!H(n)&&(o.custom_ids=n),this.context.getUserUid()&&(o.login_id=this.context.getUserUid()),o},n.prototype.preFetch=function(t,e){return this.isReady?!!y(e)||(this.context.log("".concat(t," 方法参数必须是对象"),r.WARN),!1):(this.context.log("A/B Testing 插件尚未运行，请先执行该插件",r.WARN),!1)},n.prototype.asyncFetch=function(t){var e=this;return new Promise((function(r){e.getResultFromServer(t).then((function(t){r(t)})).catch((function(){t.callback(t.defaultValue)}))}))},n.prototype.asyncFetchABTest=function(t){var e=this;if(this.preFetch("asyncFetchABTest",t)){var r=this.normalizeParams("asyncFetchABTest",t),n=r.verify_success,o=r.para;n?this.asyncFetch(o).then((function(t){return a(e,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return[4,this.getExpResult(o,t.results)];case 1:return e=r.sent(),o.callback(e||o.defaultValue),[2]}}))}))})):o.callback(o.defaultValue)}},n.prototype.fetchCacheABTest=function(t){return a(this,void 0,void 0,(function(){var e,r,n,o;return s(this,(function(i){switch(i.label){case 0:return this.preFetch("fetchCacheABTest",t)?(e=this.normalizeParams("fetchCacheABTest",t),r=e.verify_success,n=e.para,r?[4,this.getExpResult(n)]:[3,2]):[2];case 1:return o=i.sent(),n.callback(o||n.defaultValue),[3,3];case 2:n.callback(n.defaultValue),i.label=3;case 3:return[2]}}))}))},n.prototype.fastFetchABTest=function(t){return a(this,void 0,void 0,(function(){var e,r,n,o,i=this;return s(this,(function(c){switch(c.label){case 0:return this.preFetch("fastFetchABTest",t)?(e=this.normalizeParams("fastFetchABTest",t),r=e.verify_success,n=e.para,r?[4,this.getExpResult(n)]:[3,2]):[2];case 1:return b(o=c.sent())?n.callback(o):this.asyncFetch(n).then((function(){return a(i,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.getExpResult(n)];case 1:return t=e.sent(),n.callback(t||n.defaultValue),[2]}}))}))})),[3,3];case 2:n.callback(n.defaultValue),c.label=3;case 3:return[2]}}))}))},n}(h),at=function(){function t(t,e){void 0===e&&(e=!0),this.isReady=!1,this.consolePrefix="埋点SDK",this.useInstancing=!0,this.plugins=[],this.options=t,this.useInstancing=e}return t.prototype.log=function(t,e){void 0===e&&(e=r.LOG),this.options.showLog&&("string"==typeof t&&this.consolePrefix&&(t="".concat(this.consolePrefix,"：").concat(t)),F(t,e))},t.prototype.runPlugins=function(t){var e=this;t.forEach((function(t){t.disabled||t.init((function(r){if(t.transform){var n=t.transform(r);n&&e.report(n)}}))}))},t.prototype.applyPlugins=function(t){var e=this;if(this.isReady){w(t)||(t=[t]);var n=[];t.forEach((function(t){var r=new t(e.options,e);e.plugins.push(r),n.push(r)})),this.runPlugins(n)}else this.log("请先初始化SDK实例",r.WARN)},t}(),st=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.sendReportData=function(t,e,o){var i=this.options,a=i.batchSend,s=i.globalCallback,c=i.serverUrl,u=i.dataSendTimeout,l=i.sendType,h=i.customHeaders,p=i.credentials,f=i.imgUseCrossOrigin;if(l=o||l,c){if(y(t)&&!H(t))if(a)this.batchSender.add(t);else{var d=t;S(t)||(d=function(t){try{return JSON.stringify(t)}catch(e){return t}}(t));var g=B(d),v={data:"data=".concat(encodeURIComponent(g)),url:c,timeout:u,imgUseCrossOrigin:f,customHeaders:h,credentials:p};(l===n.BEACON&&navigator.sendBeacon?new et(v):l===n.IMAGE&&v.data.length<2048?new Q(v):new tt(v)).run().then((function(r){return _(s)&&s(c,t,r.type,r.msg||""),_(e)&&e(c,t,r.type,r.msg||""),r}))}}else this.log("当前 serverUrl 为空，network 中不会发数据，请配置正确的 serverUrl！",r.WARN)},o}(at);function ct(t){return 1===(null==t?void 0:t.nodeType)}function ut(t,e){var r;if("input"===(null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase()))return(["button","submit"].includes(t.type)||e)&&t.value||"";var n="";return t.textContent?n=t.textContent.trim():t.innerText&&(n=t.innerText.trim()),n&&(n=n.replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)),n||""}function lt(t,e){var r;if(!ct(t))return{};var n,o={H_element_type:null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase(),H_element_name:t.getAttribute("name"),H_element_id:t.getAttribute("id"),H_element_target_url:t.getAttribute("href"),H_element_class_name:t.classList.value||t.className,H_element_content:ut(t,e)};return n=o,Object.keys(n).reduce((function(t,e){return b(n[e])&&""!==n[e]&&(t[e]=n[e]),t}),{})}function ht(t,e){if(!t)return{};var r=document.documentElement.scrollLeft||document.body.scrollLeft||0,n=$(),o=e.getBoundingClientRect(),i=t.pageX||t.clientX+r||t.offsetX+((null==o?void 0:o.left)||0)+r,a=t.pageY||t.clientY+n||t.offsetY+((null==o?void 0:o.top)||0)+n;return{H_page_x:P(i,3),H_page_y:P(a,3)}}var pt=["mark","/mark","strong","b","em","i","u","abbr","ins","del","s","sup"],ft=["a","input","button","textarea"],dt=function(t){function n(e,r){var n=t.call(this,e,r)||this;return n.options=e,n.context=r,n.name="ClickTrackPlugin",n.isReady=!1,n.isTrackList={a:!0,button:!0},n}return e(n,t),n.prototype.init=function(t){var e=this,n=this.options.autoTrackConfig,o=n.clickAutoTrack,i=n.isCollectUrl,a=n.isCollectElement,s=n.addCustomProperty;!0===o&&(this.isReady?this.context.log("ClickTrack plugin：插件已经运行，无需重复执行",r.WARN):(this.isReady=!0,document.addEventListener("click",(function(r){if(i()){var n=r||window.event;if(n){var o=n.target||n.srcElement,c=e.getTargetElement(o);if(c){if(_(a)&&!a(c))return!1;var u=e.getClickElementInfo(c),l=ht(n,c),h=l.H_page_x,p=l.H_page_y;u.H_page_x=h,u.H_page_y=p;var f=e.getElementPosition(c,u.H_element_path);if(x(f)&&f>=0&&(u.H_element_position=f),_(s)){var d=s(c);y(d)&&(u=C(u,d))}t(u)}}}}),!0)))},n.prototype.transform=function(t){return this.context.getReportData("track","H_WebClick",t)},n.prototype.hasAttribute=function(t,e){var r;return t.hasAttribute?t.hasAttribute(e):t.attributes?!!(null===(r=t.attributes[e])||void 0===r?void 0:r.value):void 0},n.prototype.hasAttributes=function(t,e){if(w(e))for(var r=0;r<e.length;r++)if(this.hasAttribute(t,e[r]))return!0;return!1},n.prototype.hasElement=function(t){var e,r,n,o=function(t){var e=[t];try{if(!ct(t))return e;if(null===t||null===t.parentElement)return e;for(;null!==t.parentElement;)t=t.parentElement,e.push(t);return e}catch(t){}return e}(t),i=this.options.autoTrackConfig.trackAttr||[];if(w(o)&&o.length>0)try{for(var a=c(o),s=a.next();!s.done;s=a.next()){var u=s.value,l=u.tagName&&(null===(n=u.tagName)||void 0===n?void 0:n.toLowerCase());if(ct(u)&&(this.isTrackList[l]||this.hasAttributes(u,i)))return u}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}},n.prototype.getDivMaxLevel=function(){var t;return(null===(t=this.options.autoTrackConfig.collectTags.div)||void 0===t?void 0:t.maxLevel)||1},n.prototype.isStyleTag=function(t){var e,r=(null===(e=this.options.autoTrackConfig.collectTags.div)||void 0===e?void 0:e.ignoreTags)||[];return null==r?void 0:r.includes(t)},n.prototype.getCollectableParent=function(t){var e;try{var n=t.parentNode,o=n?null===(e=n.tagName)||void 0===e?void 0:e.toLowerCase():"";if("body"===o)return!1;var i=this.getDivMaxLevel();if("div"===o&&(i>1||this.isCollectableDiv(n)))return n;if(n&&this.isStyleTag(o))return this.getCollectableParent(n)}catch(t){this.context.log(t,r.ERROR)}return!1},n.prototype.isCollectableDiv=function(t){var e;try{var n=t.children||[];if(0===n.length)return!0;for(var o=0;o<n.length;o++){var i=n[o];if(ct(i)){var a=null===(e=i.tagName)||void 0===e?void 0:e.toLowerCase(),s=this.getDivMaxLevel();if(!("div"===a&&s>1||this.isStyleTag(a)))return!1;if(!this.isCollectableDiv(i))return!1}}return!0}catch(t){this.context.log(t,r.ERROR)}return!1},n.prototype.isDivLevelValid=function(t){for(var e=this.getDivMaxLevel(),r=t.getElementsByTagName("div"),n=r.length-1;n>=0;n--)if(this.getDivLevels(r[n],t)>e)return!1;return!0},n.prototype.getElementPath=function(t,e,r){for(var n,o,i=[];ct(t)&&t.parentNode;){if(t.id&&!e&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.id)){var a=t.tagName||"";i.unshift("".concat(a.toLowerCase(),"#").concat(t.id));break}if(r&&t===r){i.unshift(null===(n=t.tagName)||void 0===n?void 0:n.toLowerCase());break}if(t===document.body){i.unshift("body");break}i.unshift(null===(o=t.tagName)||void 0===o?void 0:o.toLowerCase()),t=t.parentNode}return i.join(" > ")},n.prototype.getDivLevels=function(t,e){var r=this.getElementPath(t,!0,e).split(" > "),n=0;return r.forEach((function(t){"div"===t&&n++})),n},n.prototype.getTargetElement=function(t){var e;if(!ct(t))return null;var r=null===(e=t.tagName)||void 0===e?void 0:e.toLowerCase();if(!S(r))return null;if(["body","html"].includes(r))return null;if(this.context.trackTags.includes(r)&&"div"!==r)return t;if("div"===r&&this.options.autoTrackConfig.collectTags.div&&(this.isDivLevelValid(t)&&(this.getDivMaxLevel()>1||this.isCollectableDiv(t))))return t;if(this.options.autoTrackConfig.collectTags.div&&this.isStyleTag(r)){var n=this.getCollectableParent(t);if(n&&this.isDivLevelValid(n))return n}return this.hasElement(t)||null},n.prototype.getClickElementInfo=function(t){var e=this.options.autoTrackConfig.isCollectInput,r=!1;_(e)&&(r=e(t));var n=this.getDomSelector(t),o=lt(t,r);return o.H_element_selector=n,o.H_element_path=this.getElementPath(t,!1),o},n.prototype.getDomSelector=function(t){for(var e,r=[];t;){if("body"===(null===(e=t.tagName)||void 0===e?void 0:e.toLowerCase())||!ct(t)){r.unshift("body");break}if(r.unshift(this.getSelector(t)),(null==t?void 0:t.getAttribute("id"))&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.getAttribute("id")))break;t=t.parentNode}return r.join(" > ")},n.prototype.getSelector=function(t){var e,r,n=null===(e=t.tagName)||void 0===e?void 0:e.toLowerCase(),o=-1;9!==(null===(r=t.parentNode)||void 0===r?void 0:r.nodeType)&&(o=this.getDomIndex(t));var i=t.getAttribute("id");return i&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(i)?"#".concat(i):n+(o>-1?":nth-of-type(".concat(o+1,")"):"")},n.prototype.getDomIndex=function(t){var e,r;if(t.parentNode)for(var n=0,o=null===(e=t.tagName)||void 0===e?void 0:e.toLowerCase(),i=t.parentNode.children,a=0;a<i.length;a++){var s=i[a];if((null===(r=s.tagName)||void 0===r?void 0:r.toLowerCase())===o){if(s===t)return n;n++}}return-1},n.prototype.getClosestLi=function(t){for(;t&&t!==document&&ct(t);){if("li"===t.tagName.toLowerCase())return t;t=t.parentNode}return null},n.prototype.getSameTypeSiblings=function(t){for(var e,r,n=t.parentNode,o=null===(e=t.tagName)||void 0===e?void 0:e.toLowerCase(),i=[],a=0;a<n.children.length;a++){var s=n.children[a];ct(s)&&(null===(r=s.tagName)||void 0===r?void 0:r.toLowerCase())===o&&i.push(s)}return i},n.prototype.getElementPosition=function(t,e){var r,n=this.getClosestLi(t);if(!n||!ct(t)||!S(t.tagName))return null;var o=null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase(),i=n.getElementsByTagName(o),a=i.length;if(a>1){for(var s=[],c=0;c<a;c++){this.getElementPath(i[c],!1)===e&&s.push(i[c])}if(s.length>0)return s.findIndex((function(e){return e===t}))}if(!n.parentNode)return-1;var u=this.getSameTypeSiblings(n);return 1===u.length?0:u.findIndex((function(t){return t===n}))},n}(h),gt=function(t){function n(e,r){var n=t.call(this,e,r)||this;return n.options=e,n.context=r,n.name="StayTrackPlugin",n.isReady=!1,n.timer=null,n.previousTime=I(),n.previousOffsetTop=0,n}return e(n,t),n.prototype.init=function(t){var e=this,n=this.options,o=n.autoTrackConfig,i=n.stayAutoTrackConfig;if(!0===o.stayAutoTrack)if(this.isReady)this.context.log("StayTrack plugin：插件已经运行，无需重复执行",r.WARN);else{this.isReady=!0;var a=i.isCollectUrl;_(a)||(a=function(){return!0}),this.timer&&(clearTimeout(this.timer),this.timer=null),this.previousTime=I(),window.addEventListener("load",(function(){e.previousOffsetTop=$()})),window.addEventListener("scroll",(function(){a()&&(e.timer||(e.timer=setTimeout((function(){e.run(t),clearTimeout(e.timer),e.timer=null}),1e3)))})),window.addEventListener("unload",(function(){a()&&e.run(t,!0)}))}},n.prototype.transform=function(t){return this.context.getReportData("track","H_WebStay",t)},n.prototype.run=function(t,e){void 0===e&&(e=!1);var r=this.options.autoTrackConfig,n=r.stayDelayTime,o=r.maxStayPageDuration,i=$(),a=I(),s=a-this.previousTime;(e||s>n&&i!==this.previousOffsetTop)&&t({H_viewport_width:Z(),H_viewport_height:X(),H_viewport_position:this.previousOffsetTop,event_duration:Math.min(s/1e3,o),H_url_path:window.location.pathname});this.previousTime=a,this.previousOffsetTop=i},n}(h),vt=function(t){function n(e,r){var n=t.call(this,e,r)||this;return n.options=e,n.context=r,n.name="PageLeave",n.isReady=!1,n.pageId=D(),n.storageName="hinasdk_pageleave_",n.heartbeatIntervalTime=5e3,n.maxDuration=432e3,n.heartbeatIntervalTimer=null,n.startTime=I(),n.url=window.location.href,n.pageShowStatus=!0,n}return e(n,t),n.prototype.init=function(){if(this.options.autoTrackConfig.pageLeaveAutoTrack)if(this.context.store.localStorage)if(this.isReady)this.context.log("PageLeave plugin：插件已经运行，无需重复执行",r.WARN);else{this.isReady=!0;var t=this.normalizePageLeaveAutoTrack(),e=t.heartbeat_interval_time,n=t.max_duration;e&&e>0&&(this.heartbeatIntervalTime=1e3*e),n&&n>0&&(this.maxDuration=Number(n)),this.startTime=I(),this.addPageLeaveEventListener(),document.hidden?this.pageShowStatus=!1:this.startHeartBeatInterval()}else this.context.log("PageLeave plugin需要使用localstorage存储数据，但是您的浏览器不支持localstorage，所以不能使用该功能",r.WARN)},n.prototype.transform=function(){},n.prototype.normalizePageLeaveAutoTrack=function(){var t=this.options.autoTrackConfig.pageLeaveAutoTrack;return y(t)?t:{}},n.prototype.addPageLeaveEventListener=function(){this.addPageStartListener(),this.addPageSwitchListener(),this.addSinglePageListener(),this.addPageEndListener()},n.prototype.addPageStartListener=function(){var t=this;"onpageshow"in window&&window.addEventListener("pageshow",(function(){t.pageStartHandler()}))},n.prototype.addPageSwitchListener=function(){var t=this;new Y({visible:function(){t.pageStartHandler(),t.startHeartBeatInterval()},hidden:function(){t.url=window.location.href,t.pageEndHandler(),t.stopHeartBeatInterval()}})},n.prototype.addSinglePageListener=function(){var t=this;K.on("urlChange",(function(e){var r=e.fromHref;r!==e.toHref&&(t.url=r,t.pageEndHandler(),t.stopHeartBeatInterval(),t.pageStartHandler(),t.startHeartBeatInterval())}))},n.prototype.addPageEndListener=function(){var t=this,e=["pagehide","beforeunload","unload"];e.forEach((function(r){"on".concat(e)in window&&window.addEventListener(r,(function(){t.pageEndHandler(),t.stopHeartBeatInterval()}))}))},n.prototype.pageStartHandler=function(){this.startTime=I(),this.pageShowStatus=!document.hidden,this.url=window.location.href},n.prototype.pageEndHandler=function(){if(this.pageShowStatus){if(this.pageShowStatus=!1,this.isCollectUrl()){var t=this.getPageLeaveProperties(),e=this.context.getReportData("track","H_WebPageLeave",t);this.context.report(e)}this.delHeartBeatData()}},n.prototype.startHeartBeatInterval=function(){var t=this;this.heartbeatIntervalTimer&&this.stopHeartBeatInterval(),this.isCollectUrl()&&(this.heartbeatIntervalTimer=setInterval((function(){t.saveHeartBeatData()}),this.heartbeatIntervalTime),this.saveHeartBeatData("first_heartbeat")),this.reissueHeartBeatData()},n.prototype.reissueHeartBeatData=function(){for(var t=this.context.store.localStorage,e=t.length(),r=0;r<e;r++){var n=t.key(r);if(n&&n!==this.storageName+this.pageId&&n.includes(this.storageName)){var o=A(t.get(n));y(o)&&I()-o.time>o.heartbeat_interval_time+5e3&&(delete o.heartbeat_interval_time,this.context.report(o)),this.delHeartBeatData(n)}}},n.prototype.stopHeartBeatInterval=function(){this.heartbeatIntervalTimer&&(clearInterval(this.heartbeatIntervalTimer),this.heartbeatIntervalTimer=null)},n.prototype.delHeartBeatData=function(t){this.context.store.localStorage.remove(t||this.storageName+this.pageId)},n.prototype.isCollectUrl=function(){var t=this.normalizePageLeaveAutoTrack().isCollectUrl;return!_(t)||t(this.url)},n.prototype.saveHeartBeatData=function(t){var e=this.getPageLeaveProperties();e.H_time=I(),"first_heartbeat"===t&&(e.event_duration=3);var r=this.context.getReportData("track","H_WebPageLeave",e);r.heartbeat_interval_time=this.heartbeatIntervalTime,this.context.store.localStorage.set(this.storageName+this.pageId,JSON.stringify(r))},n.prototype.getPageLeaveProperties=function(){var t=(I()-this.startTime)/1e3;t=t<=0||t>this.maxDuration?0:P(t,3);var e=R(this.url),r=e.pathname,n=e.hash,o=E(),a={H_url:this.url,H_url_path:r,H_url_hash:n,H_viewport_position:$(),H_referrer:o,H_referrer_host:o?O(o):"",event_duration:t},s=this.normalizePageLeaveAutoTrack().custom_props;return y(s)&&(a=i(i({},a),s||{})),a},n}(h),mt=function(t){function n(e,r){var n=t.call(this,e,r)||this;return n.options=e,n.context=r,n.name="SiteLinker",n.isReady=!1,n.linker=[],n}return e(n,t),n.prototype.init=function(){if(this.options.siteLinkerConfig){var t=this.getLinkerConfig().linker;w(t)&&t.length>0?this.isReady?this.context.log("SiteLinker plugin：插件已经运行，无需重复执行",r.WARN):(this.isReady=!0,this.resolveOption(),this.setRefferId(),this.addClickListen()):this.context.log("siteLinker plugin: 请配置正确的linker参数",r.WARN)}},n.prototype.transform=function(){},n.prototype.getLinkerConfig=function(){var t=this.options.siteLinkerConfig||{},e=t.linker;return{linker:(void 0===e?[]:e)||[],re_login:t.re_login}},n.prototype.resolveOption=function(){for(var t=this.getLinkerConfig().linker,e=t.length,n=[],o=0;o<e;o++){var i=t[o],a=i.part_url,s=i.after_hash;/[A-Za-z0-9]+\./.test(a)&&k(s)?n.push({part_url:a,after_hash:s}):this.context.log("The configuration of linker ".concat(o+1," is not supported.Please check format"),r.WARN)}this.linker=n},n.prototype.setRefferId=function(){var t=this.getLinkerConfig().re_login,e=this.getUrlId(),r=e.startsWith("a");if(""!==(e=e.substring(1))){var n=this.context.store.getAnonymousId(),o=this.context.store.getAccountId();if(r){if(e!==n&&(this.context.store.state.anonymousId=e,this.context.store.save()),o){var i=this.context.getReportData("track_signup","H_SignUp",{});this.context.report(i)}}else(!o||t&&o!==e)&&this.context.setUserUId(e)}},n.prototype.getUrlId=function(){var t=window.location.href.match(/_hnsdk=([au][^\?\#\&\=]+)/);return w(t)&&t[1]?function(t){var e=t;try{e=decodeURIComponent(t)}catch(t){}return e}(t[1]):""},n.prototype.getPartUrl=function(t){for(var e=this.linker.length,r=0;r<e;r++)if(t.includes(this.linker[r].part_url))return!0;return!1},n.prototype.getPartHash=function(t){for(var e=this.linker.length,r=0;r<e;r++)if(t.includes(this.linker[r].part_url))return this.linker[r].after_hash;return!1},n.prototype.getCurrentId=function(){var t=this.context.store.getAccountId(),e=this.context.store.getAnonymousId();return function(t){var e=t;try{e=encodeURIComponent(t)}catch(t){}return e}(t?"u".concat(t):"a".concat(e))},n.prototype.rewriteUrl=function(t,e){var r=function(t,e,r){var n=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(t),o="";if(n){var i=n[1]||"",a=n[2]||"",s=n[3]||"",c="_hnsdk=".concat(e),u=function(t){var e=t.split("&"),r=[];return e.forEach((function(t){t.includes("_hnsdk")?r.push(c):r.push(t)})),r.join("&")};if(r){var l=s.includes("?"),h=s.indexOf("_hnsdk");o=l?h>=0?"".concat(i).concat(a,"#").concat(s.substring(1,h)).concat(u(s.substring(h,s.length))):"".concat(i).concat(a,"#").concat(s.substring(1),"&").concat(c):"".concat(i).concat(a,"#").concat(s.substring(1),"?").concat(c)}else o=(l=/^\?(\w)+/.test(a))?a.includes("_hnsdk")?"".concat(i,"?").concat(u(a.substring(1))).concat(s):"".concat(i).concat(a,"&").concat(c).concat(s):"".concat(i,"?").concat(c).concat(s);return o}}(t,this.getCurrentId(),this.getPartHash(t));return e&&(e.href=r),r},n.prototype.addClickListen=function(){var t=this,e=function(e){var r,n,o=e.target;if(o){var i=null===(r=o.tagName)||void 0===r?void 0:r.toLowerCase(),a=o.parentNode,s=null===(n=null==a?void 0:a.tagName)||void 0===n?void 0:n.toLowerCase();if("a"===i&&o.href||"a"===s&&a.href){var c=void 0,u=void 0;"a"===i&&o.href?(c=o.href,u=o):(c=a.href,u=a);var l=R(c).protocol;"http:"!==l&&"https:"!==l||t.getPartUrl(c)&&t.rewriteUrl(c,u)}}};"PointerEvent"in window?document.addEventListener("pointerdown",e):document.addEventListener("mousedown",e)},n}(h),yt=function(t){function n(e,r){var n=t.call(this,e,r)||this;return n.options=e,n.context=r,n.name="HistoryPlugin",n.isReady=!1,n.lastHref=window.location.href,n.lastPath=window.location.pathname,n}return e(n,t),n.prototype.init=function(){if(window&&window.history.pushState&&window.history.replaceState)if(this.isReady)this.context.log("History plugin：插件已经运行，无需重复执行",r.WARN);else{this.isReady=!0;var t=this,e=window.onpopstate,n=function(e,r){var n={fromPath:t.lastPath,fromHref:t.lastHref,toPath:e,toHref:r};t.lastPath=e,t.lastHref=r,K.emit("urlChange",i(i({},n),{mode:"history"}))};window.onpopstate=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=window.location.pathname,i=window.location.href;n(o,i),e&&e.apply(this,t)},W(window.history,"pushState",o),W(window.history,"replaceState",o)}function o(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.apply(this,e);var o=window.location.pathname,i=window.location.href;n(o,i)}}},n.prototype.transform=function(){},n}(h),bt=function(t){function n(e,r){var n=t.call(this,e,r)||this;return n.options=e,n.context=r,n.name="HashPlugin",n.isReady=!1,n.lastHref=window.location.href,n.lastPath=window.location.hash,n}return e(n,t),n.prototype.init=function(){var t=this;this.isReady?this.context.log("Hash plugin：插件已经运行，无需重复执行",r.WARN):(this.isReady=!0,window.addEventListener("hashchange",(function(e){var r=e.newURL,n=R(r).hash,o={fromPath:t.lastPath,fromHref:t.lastHref,toPath:n,toHref:r};t.lastHref=r,t.lastPath=n,K.emit("urlChange",i(i({},o),{mode:"hash"}))})))},n.prototype.transform=function(){},n}(h),wt="4.0.4",_t=function(t){function r(e,r){var n,o,i=this,a=(o=null===(n=navigator.userAgent)||void 0===n?void 0:n.toLowerCase(),/android|webos|iphone|ipod|blackberry/i.test(o)?"H5":"Web");return(i=t.call(this,e,r,a,"hina_webjs_sdk_abtest",wt)||this).options=e,i.context=r,i.name="HinaABTest",i}return e(r,t),r.prototype.getResultFromServer=function(t){var e=this;return new Promise((function(r,n){var o=e.createRequestData(t);new tt({url:e.options.abTestingPluginConfig.url,data:JSON.stringify(o),contentType:"application/json",customHeaders:{"project-key":e.projectKey},timeout:t.timeoutMilliseconds}).run().then((function(t){var o=t.data;"SUCCESS"===(null==o?void 0:o.status)?e.saveResponseData(o.results).then((function(){r(o)})):n()}))}))},r}(it),St=function(){function t(){}return t.getSourceFromReferrer=function(){var t=function(t,e){for(var r=0;r<t.length;r++)if(-1!==e.split("?")[0].indexOf(t[r]))return!0},e="(".concat(p.join("|"),")\\=[^&]+"),r=document.referrer||"",n=window.location.href;if(n){var o=n.match(new RegExp(e));return o&&o[0]?"付费广告流量":t(f,r)?"自然搜索流量":t(d,r)?"社交网站流量":""===r?"直接流量":"引荐流量"}return"获取url异常"},t.getReferSearchEngine=function(t){var e,r,n=O(t);if(!n||"hostname解析异常"===n)return"";var o={baidu:[/^.*\.baidu\.com$/],bing:[/^.*\.bing\.com$/],google:[/^www\.google\.com$/,/^www\.google\.com\.[a-z]{2}$/,/^www\.google\.[a-z]{2}$/],sm:[/^m\.sm\.cn$/],so:[/^.+\.so\.com$/],sogou:[/^.*\.sogou\.com$/],yahoo:[/^.*\.yahoo\.com$/]};for(var i in o){var a=o[i];try{for(var s=(e=void 0,c(a)),u=s.next();!u.done;u=s.next()){if(u.value.test(n))return i}}catch(t){e={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}}return"未知搜索引擎"},t.getKeywordFromReferrer=function(){var t=document.referrer||"";if(0===t.indexOf("http")){var e=this.getReferSearchEngine(t),r=function(t){t=t||"";var e={};return new URLSearchParams(t).forEach((function(t,r){e[r]=t})),e}(R(t).search);if(H(r))return"未取到值";for(var n in g){var o=g[n];if(n===e)if(w(o))for(var i=0;i<o.length;i++){var a=r[o[i]];if(a)return a}else if(r[o])return r[o]}return"未取到值"}return""===t?"未取到值_直接打开":"未取到值_非http的url"},t}();function xt(t){void 0===t&&(t="");var e,r=(e={},p.forEach((function(t){var r=U(window.location.href,t);r.length&&(e[t]=r)})),e),n={};return Object.keys(r).forEach((function(e){n[t+e]=r[e]})),n}var kt=function(t){function o(e,r){void 0===r&&(r=!0);var n=t.call(this,e,r)||this;return n.trackTags=ft,n.customProperties={},n.generalProperties={H_lib_version:wt,H_lib:"js",H_lib_method:"code",H_timezone_offset:(new Date).getTimezoneOffset()},n.useInstancing&&n.init(e),n}return e(o,t),o.prototype.init=function(t){if(this.isReady)this.log("hinaSDK has been initialized",r.ERROR);else{var e={name:"",serverUrl:"",showLog:!1,autoTrackConfig:{clickAutoTrack:!0,stayAutoTrack:!0,isCollectUrl:function(){return!0},isCollectElement:function(){return!0},isCollectInput:function(){return!1},addCustomProperty:function(){},stayDelayTime:4e3,maxStayPageDuration:18e3,collectTags:{div:!1},trackAttr:["hn-click"],pageviewAutoTrack:!1,pageLeaveAutoTrack:!1},stayAutoTrackConfig:{isCollectUrl:function(){return!0}},maxStringLength:1024,imgUseCrossOrigin:!1,isSinglePage:!1,batchSend:!1,appJsBridge:!1,sendType:n.BEACON,customHeaders:{},credentials:!1,dataSendTimeout:3e3,presetProperties:{latest_utm:!0,latest_traffic_source_type:!0,latest_search_keyword:!0,latest_referrer:!0},sourceChannel:[],plugins:[]},o=t.performanceErrorConfig,a=t.plugins,s=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}(t,["performanceErrorConfig","plugins"]);this.options=C(e,s),this.options=i(i({},this.options),{performanceErrorConfig:o,plugins:a}),this.initState(),this.initAdvProps(),this.normalizeConfig(),this.initPlugins(),this.isReady=!0}},o.prototype.normalizeConfig=function(){var t=this,e=this.options,o=e.serverUrl,a=e.sendType,s=e.batchSend,c=e.maxStringLength,u=e.isSinglePage,l=e.autoTrackConfig,h=void 0===l?{}:l,p=h.trackAttr,f=void 0===p?[]:p,d=h.collectTags,g=h.pageLeaveAutoTrack,v=h.pageviewAutoTrack;if(""===(o=(o=o||"").trim()))this.log("当前 serverUrl 为空，network 中不会发数据，请配置正确的 serverUrl！",r.WARN);else{var m=R(window.location.href).protocol||"";(R(o).protocol||"")!==m&&this.log("SDK 检测到您的数据发送地址和当前页面地址的协议不一致，建议您修改成一致的协议。因为：https 下面发送 http 的图片请求会失败。",r.WARN)}if([n.IMAGE,n.AJAX,n.BEACON].includes(a)||this.setConfig({sendType:n.AJAX}),this.options.maxStringLength=function(t){var e=t;return!x(t)||t<0?e=1024:t>5120&&(e=5120),e}(c),(!0===g||y(g)&&H(g))&&(this.options.autoTrackConfig.pageLeaveAutoTrack={heartbeat_interval_time:5e3,max_duration:432e3}),w(f)?(f=f.filter((function(t){return S(t)}))).includes("hn-click")||f.push("hn-click"):f=["hn-click"],this.options.autoTrackConfig.trackAttr=f,y(d))if(!0===d.div)this.options.autoTrackConfig.collectTags.div={ignoreTags:pt,maxLevel:1};else if(y(d.div)){var b=1,k=d.div;x(k.maxLevel)&&[1,2,3].includes(k.maxLevel)&&(b=k.maxLevel),this.options.autoTrackConfig.collectTags.div={ignoreTags:pt,maxLevel:b}}else this.options.autoTrackConfig.collectTags.div=!1;else this.options.autoTrackConfig.collectTags={div:!1};this.updateTrackTags(),(!0===s||y(s)&&!H(s))&&(this.options.batchSend=i({dataSendTimeout:6e3,sendInterval:6e3,storageLimit:200},s),this.batchSender=new rt(this.options,"hinasdk_tab","hinasdk_data_")),"auto"===v?this.autoTrack():("singlePage"===v||u)&&(this.autoTrack(),K.on("urlChange",(function(e){var r=e.fromHref;if(r!==e.toHref){var n={};if(_(u)){var o=u();y(o)&&(n=i(i({},n),o))}t.autoTrack(i(i({},n),{H_referrer:r}))}})))},o.prototype.updateTrackTags=function(){var t=this.options.autoTrackConfig.collectTags,e=l([],u(ft),!1);Object.keys(t||{}).forEach((function(r){var n=t[r];!0!==n&&!y(n)||e.includes(r)||e.push(r)})),this.trackTags=e},o.prototype.initState=function(){this.store=new J(this.options),this.store.init()},o.prototype.initAdvProps=function(){var t,e={},r=this.options,n=r.presetProperties,o=r.sourceChannel;if(y(n))for(var a in n){var s=n[a];if(a.includes("latest_")&&(a=a.slice(7),s)){var c=L();if("utm"!==a&&"url解析失败"===c)e["H_latest_".concat(a)]="url的domain解析失败";else if(""===(t=(t=void 0)||document.referrer)||N(O(t))!==N())switch(a){case"traffic_source_type":e.H_latest_traffic_source_type=St.getSourceFromReferrer();break;case"search_keyword":var u=St.getKeywordFromReferrer();u&&(e.H_latest_search_keyword=u);break;case"referrer":e.H_latest_referrer=E()}}}var l=this.store.state.props||{},h={};n.latest_utm&&(h=xt("H_latest_"));var f={};l.H_utm_source||(f=xt("H_"));var d=[],g={};w(o)&&o.length>0&&(d=o.filter((function(t){return!p.includes(t)}))).length>0&&(g=i(i({},g),function(t,e){void 0===e&&(e=[]);var r={};return e.forEach((function(e){var n=U(window.location.href,e);n&&(r[e]=n,r["".concat(t).concat(e)]=n)})),r}("H_latest_",d))),this.store.state.props=i(i(i(i(i({},this.store.state.props),e),h),g),f),this.store.setProps(this.store.state.props),this.store.getUtmFromProps(d)},o.prototype.getGeneralProperties=function(){var t=new G;return this.generalProperties=i(i(i({},this.generalProperties),{H_screen_width:window.screen.width,H_screen_height:window.screen.height,H_viewport_width:Z(),H_viewport_height:X(),H_page_height:document.documentElement.scrollHeight||document.body.scrollHeight,H_browser:t.browserName,H_browser_version:t.browserVersion,H_os:t.os,H_os_version:t.osVersion,H_model:t.model,H_is_first_day:this.store.isFirstDay,H_url:window.location.href,H_url_host:O(window.location.href,"url_host取值异常"),H_title:document.title}),this.store.hLatestUtm),this.generalProperties.H_latest_referrer&&(this.generalProperties.H_latest_referrer_host=O(this.generalProperties.H_latest_referrer,"hostname解析异常")),this.generalProperties},o.prototype.initPlugins=function(){var t=this,e=this.options,r=e.serverUrl,n=e.name,o=e.showLog,a=e.sendType,s=e.customHeaders,c=e.credentials,u=e.dataSendTimeout,l=e.batchSend,h=e.imgUseCrossOrigin,p=e.globalCallback,f=e.plugins,d=void 0===f?[]:f,g=e.performanceErrorConfig,v=e.autoTrackConfig,m=e.siteLinkerConfig,b=e.abTestingPluginConfig;d=d||[];var _=v.pageLeaveAutoTrack,S=new dt(this.options,this),x=new gt(this.options,this),k=new yt(this.options,this),T=new bt(this.options,this),A=new vt(this.options,this),I=new mt(this.options,this),C=new _t(this.options,this);A.disabled=!(y(_)&&!H(_));var R=(m||{}).linker;I.disabled=!(w(R)&&R.length>0),C.disabled=!(y(b)&&!H(b)),this.plugins=[S,x,k,T,A,I,C],w(d)&&d.forEach((function(e){if("Monitor"===e.componentName){if(y(g)&&!H(g))new e(i({serverUrl:r,name:n,showLog:o,sendType:a,customHeaders:s,credentials:c,dataSendTimeout:u,batchSend:l,imgUseCrossOrigin:h,globalCallback:p},g),!0)}else{var f=new e(t.options,t);t.plugins.push(f)}})),this.runPlugins(this.plugins)},o.prototype.use=function(t,e){if(this.isReady){if(y(e)){"PageLeave"===t?this.options.autoTrackConfig.pageLeaveAutoTrack=e:"SiteLinker"===t?this.options.siteLinkerConfig=e:"HinaABTest"===t&&(this.options.abTestingPluginConfig=e);var n=this.plugins.find((function(e){return e.name===t}));return n&&(n.disabled=!1,n.isReady?this.log("".concat(t,"插件已运行，无需重复执行"),r.WARN):n.init()),this.getPluginInstance(t)}this.log("".concat(t,"插件配置项必须是一个对象类型"),r.WARN)}else this.log("请先初始化埋点SDK",r.WARN)},o.prototype.getPluginInstance=function(t){return this.plugins.find((function(e){return e.name===t}))},o.prototype.setConfig=function(t){this.options=C(this.options,t),this.normalizeConfig()},o.prototype.getConfig=function(t){return t?this.options[t]:this.options},o.prototype.setUserUId=function(t,e){var n=this;!function(t,e,n){x(t=null!=t?t:"")||S(t)?e!==(t=String(t).trim())?n(t):F("setUserUId: uid is equal to account_id, failed to execute setUserUId",r.WARN):F("setUserUId: uid must be string or number",r.WARN)}(t,this.store.getAccountId(),(function(t){n.store.setAccountId(t);var r=n.getReportData("track_signup","H_SignUp",{});n.report(r,e)}))},o.prototype.cleanUserUId=function(){this.store.setAccountId("")},o.prototype.getUserUid=function(){return this.store.state.accountId},o.prototype.setDeviceUId=function(t){this.store.setDeviceId(t)},o.prototype.getDeviceUId=function(){return this.store.getDeviceId()},o.prototype.userSet=function(t,e){if(y(t)&&!H(t)){var r=this.getReportData("user_set","",t);this.report(r,e)}},o.prototype.userSetOnce=function(t,e){if(y(t)&&!H(t)){var r=this.getReportData("user_setOnce","",t);this.report(r,e)}},o.prototype.userAdd=function(t,e){var n=this;!function(t,e){var n;S(t)&&((n={})[t]=1,t=n),y(t)&&!H(t)&&function(t){for(var e in t)if(!/-*\d+/.test(String(t[e])))return F("userAdd属性的值只能是数字",r.WARN),!1;return!0}(t)&&e(t)}(t,(function(t){var r=n.getReportData("user_add","",t);n.report(r,e)}))},o.prototype.userAppend=function(t,e){var r=this;!function(t,e){var r={};y(t)&&(Object.keys(t).forEach((function(e){var n=t[e];w(n)?r[e]=n:r[e]=[n]})),H(r)||e(r))}(t,(function(t){var n=r.getReportData("user_append","",t);r.report(n,e)}))},o.prototype.userUnset=function(t,e){var n=this;!function(t,e){var n={};S(t)&&(t=[t]),w(t)?(t.forEach((function(t){S(t)?n[t]=!0:F("userUnset参数数组里面的值必须是string,已经过滤掉".concat(t),r.WARN)})),H(n)||e(n)):F("userUnset参数必须是数组或字符串",r.WARN)}(t,(function(t){var r=n.getReportData("user_unset","",t);n.report(r,e)}))},o.prototype.userDelete=function(t){var e=this.getReportData("user_delete","",{});this.report(e,t),this.store.setAccountId("")},o.prototype.registerCommonProperties=function(t){this.customProperties=C(this.customProperties,t)},o.prototype.getPresetProperties=function(){return i(i({},this.getGeneralProperties()),this.customProperties)},o.prototype.clearPageRegister=function(t){var e=this;void 0===t&&(t=!0),!0===t?this.customProperties={}:w(t)&&t.forEach((function(t){t in e.customProperties&&delete e.customProperties[t]}))},o.prototype.track=function(t,e,n){if(n=n||function(){},S(t)){e=y(e)?e:{};var o=this.getReportData("track",t,e);this.report(o,n)}else this.log("track事件名必须是字符串，属性必须是是一个对象",r.WARN)},o.prototype.quick=function(t,e,r){if(!this.isReady)return this.log("请先初始化SDK");var n={};r=_(r)?r:T,y(e)?n=e:_(e)&&(r=e),this.autoTrack(n,r)},o.prototype.autoTrack=function(t,e){void 0===t&&(t={}),void 0===e&&(e=T);var r=(null==t?void 0:t.H_referrer)||E(),n=i(i(i({H_is_first_time:this.store.isFirstTime,H_url_path:window.location.pathname,H_referrer:r,H_referrer_host:r?O(r):""},this.store.hUtm),this.store.customUtm),t||{}),o=this.getReportData("track","H_pageview",n);if(this.report(o,e),this.store.isFirstTime){this.store.isFirstTime=!1;var a=E(),s=i(i({H_first_visit_time:I(),H_first_referrer:a,H_first_referrer_host:a?O(a,"取值异常"):"",H_first_traffic_source_type:St.getSourceFromReferrer(),H_first_search_keyword:St.getKeywordFromReferrer(),H_first_browser_language:S(navigator.language)?navigator.language.toLowerCase():"取值异常",H_first_browser_charset:document.characterSet||document.inputEncoding||"UTF-8"},this.store.hUtm),this.store.customUtm);this.userSetOnce(s)}},o.prototype.report=function(t,e,n){var o,i,a=this.options,s=a.appJsBridge,c=a.serverUrl;if(this.log(t),s){var u=!0,l=null===window||void 0===window?void 0:window.Hina_Cloud_H5_Bridge;if(y(l)&&l.track)u=!1,l.track(t.event,t.type,JSON.stringify(t));else{var h=null===(i=null===(o=null===window||void 0===window?void 0:window.webkit)||void 0===o?void 0:o.messageHandlers)||void 0===i?void 0:i.hinaNativeTracker;if(null==h?void 0:h.postMessage){u=!1;var p=JSON.stringify({eventName:t.event,eventType:t.type,properties:t});h.postMessage(p)}}if(u)return void this.log("JSBridge 发送数据失败",r.WARN);_(e)&&e(c,t)}else this.sendReportData(t,e,n)},o.prototype.getReportData=function(t,e,r){var n,o=this.store.getAnonymousId(),a=this.store.getAccountId(),s=I(),c=C(this.customProperties),u=this.getGeneralProperties();if("user"===t.slice(0,4)){var l=u.H_lib,h=u.H_lib_method,p=u.H_lib_version;n=i({device_id:this.store.getDeviceId(),H_lib:l,H_lib_method:h,H_lib_version:p},r||{})}else n=i(i(i({device_id:this.store.getDeviceId()},u),c),r||{});nt(n,this.options.maxStringLength);var f={anonymous_id:o,type:t,event:e,time:s,_track_id:D(),properties:n};return a&&!/^[0-9a-f]{8,}-[0-9a-f]{4,}-[0-9a-f]{4,}-[0-9a-f]{4,}-[0-9a-f]{12,}$/.test(a)&&(f.account_id=a),f.send_time=I(),f},o}(st);var Tt=new kt({},!1);export{r as ConsoleTypes,kt as HinaTrack,h as PluginBase,n as ReportTypes,o as VariablesTypes,Tt as default};
